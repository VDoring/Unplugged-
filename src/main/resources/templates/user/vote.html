<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>투표하기</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>

<!--<div th:insert="common/header.html" class="header"></div>-->


<!-- 코드 시작-->

<html>
<head>
    <style>
        /* 스타일 코드 */
        h1 {
            text-align: center;
        }

        #write-button {
            display: block;
            margin: 0 auto;
        }

        #write-form {
            display: none;
            margin: 10px auto;
            width: 80%;
            border: 1px solid black;
            padding: 10px;
        }

        #write-form input[type="text"] {
            width: 100%;
        }

        #write-form input[type="submit"] {
            display: block;
            margin: 10px auto;
        }

        #board {
            margin: 10px auto;
            width: 80%;
            border-collapse: collapse;
        }

        #board th, #board td {
            border: 1px solid black;
            padding: 10px;
        }

        .vote-button {
            display: inline-block;
            margin-right: 10px;
        }

        .vote-result {
            display: inline-block;
            width: 100px;
            height: 20px;
            background-color: lightgray;
        }

        .vote-result span {
            display: inline-block;
            height: 100%;
            background-color: green;
        }
    </style>
</head>
<body>
<h1>투표 게시판</h1>
<button id="write-button">글쓰기</button>
<form id="write-form">
    <p>제목: <input type="text" id="title-input" required></p>
    <p>선택지1: <input type="text" id="option1-input" required></p>
    <p>선택지2: <input type="text" id="option2-input" required></p>
    <input type="submit" value="작성완료">
</form>
<table id="board">
    <thead>
    <tr>
        <th>제목</th>
        <th>선택지</th>
        <th>결과</th>
    </tr>
    </thead>
    <tbody id="board-body">

    </tbody>
</table>

<script>
    // 자바스크립트 코드
    // 글쓰기 버튼을 클릭하면 폼이 나타나고 다시 클릭하면 폼이 사라지는 함수
    function toggleWriteForm() {
        var writeButton = document.getElementById("write-button");
        var writeForm = document.getElementById("write-form");
        if (writeForm.style.display == "none") {
            writeForm.style.display = "block";
            writeButton.innerText = "취소";
        } else {
            writeForm.style.display = "none";
            writeButton.innerText = "글쓰기";
            resetWriteForm();
        }
    }

    // 글쓰기 폼을 초기화하는 함수
    function resetWriteForm() {
        var titleInput = document.getElementById("title-input");
        var option1Input = document.getElementById("option1-input");
        var option2Input = document.getElementById("option2-input");
        titleInput.value = "";
        option1Input.value = "";
        option2Input.value = "";
    }

    // 글쓰기 폼을 제출하면 투표 게시글을 생성하고 투표 게시판에 추가하는 함수
    function submitWriteForm(event) {
        event.preventDefault(); // 폼의 기본 동작(새로고침)을 막음
        var titleInput = document.getElementById("title-input");
        var option1Input = document.getElementById("option1-input");
        var option2Input = document.getElementById("option2-input");

        // 입력값을 가져옴
        var title = titleInput.value;
        var option1 = option1Input.value;
        var option2 = option2Input.value;

        // 투표 게시글 객체를 생성함
        var post = {
            title: title,
            option1: option1,
            option2: option2,
            vote1: 0, // 투표수는 처음에 0으로 초기화함
            vote2: 0
        };

        // 투표 게시글을 투표 게시판에 추가하는 함수를 호출함
        addPostToBoard(post);

        // 글쓰기 폼을 숨기고 초기화함
        toggleWriteForm();
    }

    // 투표 게시글을 투표 게시판에 추가하는 함수
    function addPostToBoard(post) {
        var boardBody = document.getElementById("board-body");

        // 새로운 행을 생성함
        var newRow = document.createElement("tr");

        // 제목 셀을 생성하고 내용을 추가함
        var titleCell = document.createElement("td");
        titleCell.innerText = post.title;

        // 선택지 셀을 생성하고 내용을 추가함
        var optionCell = document.createElement("td");
        var option1Button = document.createElement("button");
        var option2Button = document.createElement("button");
        option1Button.innerText = post.option1;
        option2Button.innerText = post.option2;
        option1Button.classList.add("vote-button");
        option2Button.classList.add("vote-button");

        // 선택지 버튼에 클릭 이벤트 리스너를 추가함
        // 클릭하면 해당 투표수를 증가시키고 결과를 업데이트하는 함수를 호출함
        option1Button.addEventListener("click", function() {
            post.vote1++;
            updateVoteResult(post);
        });

        option2Button.addEventListener("click", function() {
            post.vote2++;
            updateVoteResult(post);
        });

        // 선택지 셀에 버튼을 추가함
        optionCell.appendChild(option1Button);
        optionCell.appendChild(option2Button);

        // 결과 셀을 생성하고 내용을 추가함
        var resultCell = document.createElement("td");

// 결과 셀에 투표 결과를 보여주는 요소를 추가함
        var result = document.createElement("div");
        var result1Span = document.createElement("span");
        var result2Span = document.createElement("span");
        result.classList.add("vote-result");
        result1Span.style.backgroundColor = "blue"; // 선택지1의 색상
        result2Span.style.backgroundColor = "red"; // 선택지2의 색상
        result.appendChild(result1Span);
        result.appendChild(result2Span);
        resultCell.appendChild(result);

// 투표 게시글 객체에 결과 셀을 참조하는 속성을 추가함
// 투표 결과를 업데이트할 때 사용함
        post.resultCell = resultCell;

        // 새로운 행에 셀을 추가함
        newRow.appendChild(titleCell);
        newRow.appendChild(optionCell);
        newRow.appendChild(resultCell);

        // 투표 게시판의 몸체에 새로운 행을 추가함
        boardBody.appendChild(newRow);
    }

    // 투표 결과를 업데이트하는 함수
    function updateVoteResult(post) {
        var resultCell = post.resultCell;
        var result = resultCell.children[0];
        var result1Span = result.children[0];
        var result2Span = result.children[1];

        // 투표수의 비율을 계산함
        var totalVote = post.vote1 + post.vote2;
        var ratio1 = Math.round(post.vote1 / totalVote * 100);
        var ratio2 = Math.round(post.vote2 / totalVote * 100);

        // 결과 요소의 너비를 비율에 맞게 조정함
        result1Span.style.width = ratio1 + "%";
        result2Span.style.width = ratio2 + "%";
    }

    // 글쓰기 버튼에 클릭 이벤트 리스너를 추가함
    var writeButton = document.getElementById("write-button");
    writeButton.addEventListener("click", toggleWriteForm);

    // 글쓰기 폼에 제출 이벤트 리스너를 추가함
    var writeForm = document.getElementById("write-form");
    writeForm.addEventListener("submit", submitWriteForm);
</script>
</body>
</html>

<!-- 코드 끝 -->

<!-- FOOTER -->
<div th:insert="common/footer.html" class="footer"></div>

</body>
</html>